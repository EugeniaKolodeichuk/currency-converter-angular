<div class="header">
    <h2>Exchange rate {{ (historicalData$ | async).date | date: "dd.MM.YYYY" }}</h2>

    <div class="datepicker">
        <input 
            matInput  
            [matDatepicker]="datepicker" 
            placeholder="Choose a date" 
            [(ngModel)]="datepickerData"
            [max]="currentDate"
        >
        <mat-datepicker-toggle matSuffix  [for]="datepicker"></mat-datepicker-toggle>
        <mat-datepicker #datepicker [startAt]="currentDate" (opened)="datepickerOpen()"></mat-datepicker>
        <button mat-raised-button (click)="updateRate()">Update Currencies</button>  
    </div>
    
    <div class="rate-buttons">
        <p>USD: <b>{{ ((1 / ((historicalData$ | async) || (currentData$ | async)).rates.USD).toFixed(2)) }}</b></p>
        <p>EUR: <b>{{ ((1 / ((historicalData$ | async) || (currentData$ | async)).rates.EUR).toFixed(2)) }}</b></p>
    </div>
</div>

<hr style="width:100vw">

<div class="converter-container">
    <ng-container *ngIf="(addCurrency$ | async).length">
        <div class="saved-currencies">
            <h3>Saved currencies</h3>
            <div *ngFor="let selectedCurrency of addCurrency$ | async">
                <p><b>{{ selectedCurrency }}</b></p>
            </div>
        </div>
    
        <div class="currency-select-container">
            <h3>Select a currency to view the chart</h3>
            <mat-form-field appearance="fill">
            <mat-label>Follow Dynamic</mat-label>
            <mat-select [(value)]="chartCurrency">
                <mat-option *ngFor="let selectedCurrency of addCurrency$ | async" [value]="selectedCurrency">
                {{ selectedCurrency }}
                </mat-option>
            </mat-select>
            </mat-form-field>
            <button *ngIf="chartCurrency" mat-raised-button class="chart-button" (click)="onViewChart(chartCurrency)">View Chart</button>
        </div>

        <hr style="width:100vw">

        <div *ngIf="chartCurrency && (currencyRateData$ | async)" style="display: block;">
            <canvas baseChart width="1000" height="400"
                [type]="'line'"
                [data]="lineChartData">
            </canvas>
        </div>

        <hr style="width:100vw">
    </ng-container>
    
    <h1>Currency converter ({{ currentDate | date: "dd.MM.YYYY" }})</h1>
    <input [ngModel]="amount$ | async" (ngModelChange)="onAmountChange($event)">
    <div *ngIf="amountValue" class="container">
        <div class="converted-currencies" *ngFor="let currency of currenciesRates">
            <p>{{ (currency.code + ' ' + (currency.value * amountValue).toFixed(2)) }}</p>
            <button mat-raised-button (click)="onAddCurrency(currency.code)">Add currency</button>
        </div>
    </div>
</div>

<div *ngIf="isLoading$ | async" class="overlay">
    <div class="overlay-wrapper">
        <mat-spinner></mat-spinner>
    </div>
</div>
